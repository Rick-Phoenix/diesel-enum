[package]
name = "diesel-enums"
version = { workspace = true }

description = "Seamless mapping between rust enums and custom postgres types or regular lookup tables, with automatically generated consistency checks."

edition.workspace = true
license = { workspace = true }
repository = { workspace = true }

readme = true

[package.metadata.release]
tag = true

[dev-dependencies]
diesel_migrations = "2.3.0"
pgtemp = "0.6.0"
deadpool-diesel = { version = "0.6", features = ["sqlite", "postgres"] }
deadpool-sync = "0.1.4"
dotenvy = "0.15"
diesel = { version = "2.3", features = [
  "sqlite",
  "returning_clauses_for_sqlite_3_35",
] }
tokio = { version = "1", features = ["full"] }

[dependencies]
document-features = "0.2"

diesel-enums-proc-macro = { path = "../proc-macro/", version = "0.1.0" }
owo-colors = { version = "4", optional = true, features = ["supports-colors"] }
thiserror = "2"

tokio = { version = "1", features = [
  "time",
  "macros",
  "sync",
], optional = true }
deadpool-diesel = { version = "0.6", optional = true }
deadpool-sync = { version = "0.1", optional = true }
dotenvy = { version = "0.15", optional = true }
diesel = { version = "2.3", optional = true }

[features]

default = ["pretty-test-errors"]

## Enables prettified, colored output from errors
pretty-test-errors = ["dep:owo-colors"]

test-utils = []

## Exports the test runner for sqlite
sqlite = [
  "test-utils",
  "dep:tokio",
  "dep:dotenvy",
  "dep:diesel",
  "deadpool-diesel/sqlite",
  "dep:deadpool-sync",
  "diesel/sqlite",
]

## Exports the test runner for postgres
postgres = [
  "test-utils",
  "dep:tokio",
  "dep:dotenvy",
  "dep:diesel",
  "deadpool-diesel/postgres",
  "diesel/postgres",
]
